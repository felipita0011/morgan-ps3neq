(function(n){(function(n){typeof define=="function"&&define.amd?define(n):n()})(function(){function i(n,t){return function(){return n.apply(t,arguments)}}function c(n,t){for(var i in t)t.hasOwnProperty(i)&&(n.style[i]=t[i]);window.WookMarkOnePixelFix()}function l(n,t){h(function(){for(var r,i=0;i<n.length;i++)r=n[i],c(r.el,r.css);typeof t=="function"&&h(t)})}function e(n){return n.replace(/^\s+|\s+$/g,"").toLowerCase()}function o(t,i,r){window.jQuery?n(t).off(i,r):t.removeEventListener?t.removeEventListener(i,r):t.detachEvent("on"+i,r)}function a(t,i,r){if(o(t,i,r),window.jQuery)n(t).on(i,r);else t.addEventListener?t.addEventListener(i,r):t.attachEvent("on"+i,function(){r.call(t)})}function w(n){return n.offsetParent===null}function b(n){return n.offsetHeight}function s(n){return n.offsetWidth}function v(n,t){return n.classList?n.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(n.className)}function y(n,t){n.classList?n.classList.add(t):n.className+=" "+t}function k(n,t){n.classList?n.classList.remove(t):n.className=n.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," ")}function r(n,t,i,r){r===undefined&&(r="wookmark-");var u=n.getAttribute("data-"+r+t);return i===!0?parseInt(u,10):u}function u(n,t,i,r){r===undefined&&(r="wookmark-");n.setAttribute("data-"+r+t,i)}function d(n){for(var u={},f=[],t,i=n.length;i--;)t=r(n[i],"id",!0),u.hasOwnProperty(t)||(u[t]=1,f.push(n[i]));return f}function p(n,t){return window.getComputedStyle!==undefined?window.getComputedStyle(n,null).getPropertyValue(t):n.currentStyle[t]}function g(n,t){for(var r=n.length,i=0;i<r;i++)if(n[i]===t)return i;return-1}function t(n,t){t=t||{};typeof n=="string"&&(n=document.querySelector(n));this.container=n;this.columns=this.resizeTimer=null;this.activeItemCount=0;this.placeholders=[];this.itemHeightsInitialized=!1;this.itemHeightsDirty=!1;this.elementTag="div";this.initItems=i(this.initItems,this);this.updateOptions=i(this.updateOptions,this);this.onResize=i(this.onResize,this);this.onRefresh=i(this.onRefresh,this);this.getItemWidth=i(this.getItemWidth,this);this.layout=i(this.layout,this);this.layoutFull=i(this.layoutFull,this);this.layoutColumns=i(this.layoutColumns,this);this.filter=i(this.filter,this);this.clear=i(this.clear,this);this.getActiveItems=i(this.getActiveItems,this);this.refreshPlaceholders=i(this.refreshPlaceholders,this);this.sortElements=i(this.sortElements,this);this.updateFilterClasses=i(this.updateFilterClasses,this);this.initItems();this.container.style.display="block";this.updateOptions(t);this.updateFilterClasses();this.autoResize&&a(window,"resize",this.onResize);a(this.container,"refreshWookmark",this.onRefresh)}var f={align:"center",autoResize:!0,comparator:null,direction:undefined,ignoreInactiveItems:!0,inactiveClass:"wookmark-inactive",itemSelector:undefined,itemWidth:0,fillEmptySpace:!1,flexibleWidth:0,offset:5,outerOffset:0,onLayoutChanged:undefined,placeholderClass:"wookmark-placeholder",possibleFilters:[],resizeDelay:50,verticalOffset:undefined},h=window.requestAnimationFrame||function(n){n()};return t.prototype.initItems=function(){if(this.itemSelector===undefined){for(var i=[],n,r=this.container.children,t=r.length;t--;)n=r[t],n.nodeType!==8&&(n.style.display="",u(n,"id",t),i.unshift(n));this.items=i}else this.items=this.container.querySelectorAll(this.itemSelector);this.items.length&&(this.elementTag=this.items[0].tagName);this.itemHeightsDirty=!0},t.prototype.updateFilterClasses=function(){for(var s=this.items.length,u,n={},t,f,i,h=this.possibleFilters,c=h.length,o;s--;)if(f=this.items[s],t=JSON.parse(r(f,"filter-class",!1,"")),t&&typeof t=="object")for(u=t.length;u--;)i=e(t[u]),n.hasOwnProperty(i)||(n[i]=[]),n[i].push(f);while(c--)o=e(h[c]),n.hasOwnProperty(o)||(n[o]=[]);this.filterClasses=n},t.prototype.updateOptions=function(n){var t;this.itemHeightsDirty=!0;n=n||{};for(t in f)f.hasOwnProperty(t)&&(n.hasOwnProperty(t)?this[t]=n[t]:this.hasOwnProperty(t)||(this[t]=f[t]));this.verticalOffset=this.verticalOffset||this.offset;this.layout(!0)},t.prototype.onResize=function(){clearTimeout(this.resizeTimer);this.itemHeightsDirty=this.flexibleWidth!==0;this.resizeTimer=setTimeout(this.layout,this.resizeDelay)},t.prototype.onRefresh=function(){this.itemHeightsDirty=!0;this.layout()},t.prototype.filter=function(n,t,i){var o=[],h,u=[],r,a,v,p,f,s,c,w,l;if(n=n||[],t=t||"or",i=i||!1,n.length){for(r=0;r<n.length;r++)p=e(n[r]),this.filterClasses.hasOwnProperty(p)&&o.push(this.filterClasses[p]);if(r=h=o.length,t==="or"||h===1)while(r--)u=u.concat(o[r]);else if(t==="and"){for(f=o[0],s=!0;r--;)o[r].length<f.length&&(f=o[r]);for(f=f||[],r=f.length;r--;){for(w=f[r],a=h,s=!0;a--&&s;)if(l=o[a],f!==l){for(c=!1,v=l.length;v--&&!c;)c=l[v]===w;s&=c}s&&(u=u.concat(f[r]))}}if(h>1&&(u=d(u)),!i)for(r=this.items.length;r--;)g(u,this.items[r])===-1&&y(this.items[r],this.inactiveClass)}else u=this.items;if(!i){for(r=u.length;r--;)k(u[r],this.inactiveClass);this.columns=null;this.layout()}return u},t.prototype.refreshPlaceholders=function(n,t){var i,v=b(this.container),e=this.columns.length,u,o,f,s,a="",h,l;if(this.placeholders.length<e){for(i=0;i<e-this.placeholders.length;i++)a+="<"+this.elementTag+' class="'+this.placeholderClass+'"/>';this.container.insertAdjacentHTML("beforeend",a);this.placeholders=this.container.querySelectorAll("."+this.placeholderClass)}for(f=this.offset+parseInt(p(this.placeholders[0],"border-left-width"),10)*2||0,f+=parseInt(p(this.placeholders[0],"padding-left"),10)*2||0,i=0;i<this.placeholders.length;i++)h=this.placeholders[i],u=this.columns[i],i>=e||u.length===0?h.style.display="none":(s=u[u.length-1],l=r(s,"top",!0)+r(s,"height",!0)+this.verticalOffset,o=Math.max(0,v-l-f),c(h,{position:"absolute",display:o>0?"block":"none",left:i*n+t+"px",top:l+"px",width:n-f+"px",height:o+"px"}))},t.prototype.getActiveItems=function(){var u=this.inactiveClass,n,r=[],t,i=this.items;if(this.ignoreInactiveItems)for(n=0;n<i.length;n++)t=i[n],v(t,u)||r.push(t);else return i;return r},t.prototype.getItemWidth=function(){var n=this.itemWidth,i=s(this.container)-2*this.outerOffset,t=this.flexibleWidth;if(typeof n=="function"&&(n=this.itemWidth()),this.items.length>0&&(n===undefined||n===0&&!this.flexibleWidth)?n=s(this.items[0]):typeof n=="string"&&n.indexOf("%")>=0&&(n=parseFloat(n)/100*i),t){typeof t=="function"&&(t=t());typeof t=="string"&&t.indexOf("%")>=0&&(t=parseFloat(t)/100*i);var r=i+this.offset,f=Math.floor(.5+r/(t+this.offset)),e=Math.floor(r/(n+this.offset)),u=Math.max(f,e),o=Math.min(t,Math.floor((i-(u-1)*this.offset)/u));n=Math.max(n,o)}return n},t.prototype.layout=function(n,t){var h;if(n||!w(this.container)){var c=this.getItemWidth(),i=c+this.offset,y=s(this.container),l=y-2*this.outerOffset,r=Math.floor((l+this.offset)/i),f,a=0,v=this.getActiveItems(),e=v.length,o;if(n||this.itemHeightsDirty||!this.itemHeightsInitialized){for(h=0;h<e;h++)o=v[h],this.flexibleWidth&&(o.style.width=c+"px"),u(o,"height",o.offsetHeight);this.itemHeightsDirty=!1;this.itemHeightsInitialized=!0}r=Math.max(1,Math.min(r,e));f=this.outerOffset;this.align==="center"&&(f+=Math.floor(.5+(l-(r*i-this.offset))>>1));this.direction=this.direction||(this.align==="right"?"right":"left");a=n||this.columns===null||this.columns.length!==r||this.activeItemCount!==e?this.layoutFull(i,r,f):this.layoutColumns(i,f);this.activeItemCount=e;this.container.style.height=a+"px";this.fillEmptySpace&&this.refreshPlaceholders(i,f);this.onLayoutChanged!==undefined&&typeof this.onLayoutChanged=="function"&&this.onLayoutChanged();typeof t=="function"&&t()}},t.prototype.sortElements=function(n){return typeof this.comparator=="function"?n.sort(this.comparator):n},t.prototype.layoutFull=function(n,t,i){var s,o=0,h=0,a,b,c=null,f=null,p,e=[],w=[],d=this.align==="left",k=this;for(this.columns=[],a=this.sortElements(this.getActiveItems()),b=a.length;e.length<t;)e.push(this.outerOffset),this.columns.push([]);while(h<b){for(s=a[h],c=e[0],f=0,o=0;o<t;o++)e[o]<c&&(c=e[o],f=o);u(s,"top",c);p=i;(f>0||!d)&&(p+=f*n);w[h]={el:s,css:{position:"absolute",top:c+"px"}};w[h].css[this.direction]=p+"px";e[f]+=r(s,"height",!0)+this.verticalOffset;this.columns[f]&&this.columns[f].push(s);h++}return l(w,function(){v(k.container,"wookmark-initialised")||y(k.container,"wookmark-initialised")}),Math.max.apply(Math,e)},t.prototype.layoutColumns=function(n,t){for(var s=[],h=[],f=0,c=0,e=this.columns.length,i,a,o,v;e--;){for(i=this.outerOffset,s.push(i),a=this.columns[e],v=e*n+t,f=0;f<a.length;f++,c++)o=a[f],u(o,"top",i),h[c]={el:o,css:{top:i+"px"}},h[c].css[this.direction]=v+"px",i+=r(o,"height",!0)+this.verticalOffset;s[e]=i}return l(h),Math.max.apply(Math,s)},t.prototype.clear=function(){clearTimeout(this.resizeTimer);for(var n=this.placeholders.length;n--;)this.container.removeChild(this.placeholders[n]);o(window,"resize",this.onResize);o(this.container,"refreshWookmark",this.onRefresh)},window.jQuery!==undefined&&(jQuery.fn.wookmark=function(i){var r=this.length;if(i!==undefined&&i.container instanceof jQuery&&(i.container=i.container[0]),r>1)while(r--)n(this).eq(r).wookmark(i);else r===1&&(this.wookmarkInstance?this.wookmarkInstance.updateOptions(i||{}):this.wookmarkInstance=new t(this[0],i||{}));return this}),window.Wookmark=t,t})})(jQuery)